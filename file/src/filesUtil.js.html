<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../">
  <title data-ice="title">src/filesUtil.js | chris-utils</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  <script src="script/manual.js"></script>
</head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
</header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/clientUtil.js~ClientUtil.html">ClientUtil</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/feedUtil.js~FeedUtil.html">FeedUtil</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/filesUtil.js~FilesUtil.html">FilesUtil</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/pluginUtil.js~PluginUtil.html">PluginUtil</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">src/filesUtil.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">/** * Imports ***/
import {Request} from &quot;@fnndsc/chrisapi&quot;;
import FileSaver from &apos;file-saver&apos;;
/**
 * An instance of this class represents Files utility service
 */
export default class FilesUtil{
  /**
   * Constructor
   *
   * @param {Client} chrisClient A Chris Client Object
   */
  constructor(chrisClient){
    this.chrisClient = chrisClient;
  }
  
  /**
   * Create a service object of this class
   *
   * @param {Client} chrisClient A Chris Client object
   *
   * @return {FilesUtil} An instance of this class
   */
  static createService(chrisClient){
  
    return new FilesUtil(chrisClient);
  }

  /**
   * Upload files to CUBE
   *
   * @param {Array} files An array of files object
   *
   * @return {Promise&lt;String&gt;}  JS Promise, resolves to a string value 
   */
  async uploadFiles(files){
    if(files.length==0){
      console.log(&quot;Please upload files!&quot;);
    }
    
    //Upload all files to CUBE
    const user = await this.chrisClient.getUser();
    const uploadDir = user.data.username + &apos;/uploads/&apos; + Date.now() + &apos;/&apos;;
    for(var f=0;f&lt;files.length;f++){
          var upload = await this.chrisClient.uploadFile({
          upload_path: uploadDir+ files[f].name
          },{
          fname: files[f]
          });
    }
      
    return uploadDir;
    
  };
  
  /**
   * Download files of a given plugin instance
   *
   * @param {Object} pluginInstance
   */
  async downloadFiles(pluginInstance){
  };
  
  /**
   * Download a zip file of a given pfdorun instance
   *
   * @param {Object} pfdoInst Id of a particular feed in CUBE
   * @param {String} zipName Id of a particular feed in CUBE
   * 
   */
  async downloadZip(pfdoInst,zipName){
    const params = { limit: 200, offset: 0 };
    const pluginFiles = await pfdoInst.getFiles(params);

    for(const pluginFile of pluginFiles.collection.items){
      const filePath = pluginFile.data[2].value;
      const paths = filePath.split(&apos;/&apos;);
      const fileName = paths[paths.length-1];
      if(fileName==&apos;parent.zip&apos;){
        const resp = await this._download(pluginFile.links[0].href);
        FileSaver.saveAs(resp, zipName+&quot;.zip&quot;);
      } 
      
    }
    
  };
  
  /**
   * Private method to download a blob/file/stream from CUBE 
   *
   * @param {String} url API endpoint to a particular resource in CUBE
   * @response {Promise} JS promise, resolves to a string value
   */
  _download(url){
    const req = new Request(this.chrisClient.auth, &apos;application/octet-stream&apos;, 30000000);
    const blobUrl = url;
    return req.get(blobUrl).then(resp =&gt; resp.data);
  };
  
  
}
</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(1.1.0)</span><img src="./image/esdoc-logo-mini-black.png"></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
