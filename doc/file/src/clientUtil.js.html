<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../">
  <title data-ice="title">src/clientUtil.js | chris-utils</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  <script src="script/manual.js"></script>
</head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
</header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/clientUtil.js~ClientUtil.html">ClientUtil</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/feedUtil.js~FeedUtil.html">FeedUtil</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/filesUtil.js~FilesUtil.html">FilesUtil</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/pluginUtil.js~PluginUtil.html">PluginUtil</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">src/clientUtil.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">/** * Imports ***/
import Client from &quot;@fnndsc/chrisapi&quot;;
import PluginUtil from &quot;./pluginUtil&quot;;
import FilesUtil from &quot;./filesUtil&quot;;
import FeedUtil from &quot;./feedUtil&quot;;

/**
 * An instance of this class represents Client utility service
 */
export default class ClientUtil{

  /**
   * Constructor
   *
   * @param {Client} chrisClient A Chris Client Object
   */
  constructor(chrisClient){

    this.chrisClient = chrisClient;
    
  }
  /**
   * Create a service object of this class
   *
   * @param  {String} url CUBE&apos;s url
   * @param  {String} userName User&apos;s username in CUBE
   * @param  {String} password User&apos;s password
   *
   * @return {Promise&lt;ClientUtil&gt;} JS Promise, resolves to an object of this class
   */
  static async createService(url,userName,password){
  
    const authUrl = url + &apos;auth-token/&apos;;
      
    const authToken= await Client.getAuthToken(authUrl, userName,password);
    
    const auth = {token :authToken};
    
    const chrisClient = new Client(url, auth);

    return new ClientUtil(chrisClient);
    
  };
  
  /**
   * Get an instance of Chris Client
   *
   *
   * @return {Client} A ChRIS client object
   */
  getClient(){

      return this.chrisClient;
  };
  
  /**
   * Create a new Feed with the given files
   *
   * @param {Array} files An array of files object
   * @param {String} feedName name of the &apos;pl-dircopy&apos; instance in CUBE
   *
   * @return {Promise&lt;Feed&gt;}  JS Promise, resolves to a Feed object
   */
  async createUploadFeed(files,feedName){
     
     // Upload files
     const filesService = FilesUtil.createService(this.chrisClient);
     const uploadDirName = await filesService.uploadFiles(files);
    
     // Create a new feed
     const feedService = FeedUtil.createService(this.chrisClient);
     const newFeed = await feedService.createFeed(uploadDirName, feedName);
     return newFeed;
    
  };
    
  /**
   * Create a downloading feed given an existing feed id
   *
   * @param {number} feedId
   * @param {string} newFeedName
   *
   * @return {Promise&lt;Feed&gt;} JS Promise, resolves to a Feed object
   */
  async createDownloadFeed(feedId, newFeedName){
  
    // Fetch the feed
    const feedService = FeedUtil.createService(this.chrisClient);
    const feed = await feedService.getFeed(feedId);
    const feedDirPath = feed.data.creator_username + &quot;/feed_&quot; + feedId;
    
    // create a new feed &amp; zip contents
    const newFeed = await feedService.createAndZipFeed(feedDirPath, newFeedName, feed.data.name);
    return newFeed;
    
  };
   
}
</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(1.1.0)</span><img src="./image/esdoc-logo-mini-black.png"></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
