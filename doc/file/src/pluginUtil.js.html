<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../">
  <title data-ice="title">src/pluginUtil.js | chris-utils</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  <script src="script/manual.js"></script>
</head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
</header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/clientUtil.js~ClientUtil.html">ClientUtil</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/feedUtil.js~FeedUtil.html">FeedUtil</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/filesUtil.js~FilesUtil.html">FilesUtil</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/pluginUtil.js~PluginUtil.html">PluginUtil</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">src/pluginUtil.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">
/**
 * An instance of this class represents Plugin utility service
 */
export default class PluginUtil{
  /**
   * Constructor
   *
   * @param {Client} chrisClient A Chris Client Object
   */
  constructor(chrisClient){
    this.chrisClient = chrisClient;
  }
  
  /**
   * Create  a service object of this class 
   *
   * @param {Client} chrisClient A ChRIS client object
   * 
   * @return {PluginUtil} An instance of this class
   */
  static createService(chrisClient){
    return new PluginUtil(chrisClient);
  } 
  
  /**
   * Get a plugin id from its given name
   *
   * @param {String} pluginName A name of a chris plugin registered to CUBE
   * 
   * @return {Promise&lt;number&gt;} A JS promise, resolves to a number representing the plugin id
   */
  async getPluginId(pluginName){
  
    const searchParams = {name : pluginName};
    
    const response = await this.chrisClient.getPlugins(searchParams);
    
    return response.data[0].id;
    
  };
  
  /**
   * Run a plugin in CUBE, given its id and params
   *
   * @param {number} pluginId Id of a registered Chris plugin
   * @param {Object} pluginParams parameters of plugin
   *
   * @return {Promise&lt;PluginInstance&gt;} A JS Promise, resolves to a PluginInstance Object
   */
   async runPlugin(pluginId, pluginParams){
     const pluginInst = await this.chrisClient.createPluginInstance(pluginId, pluginParams);
     return pluginInst;
   };
   
   /**
    *
    *
    *
    *
    */
   async pollPlugin(pluginInst, callback, callbackParams){
     
     const instId = pluginInst.data.id;
     
     const delay = ms =&gt; new Promise(res =&gt; setTimeout(res, ms));
     let status = pluginInst.data.status;
     do {
       await delay(5000);

       const inst = await this.getPluginInstance(instId);
       status = inst.data.status;
       console.log(status);
     }
     while (status !== &apos;finishedSuccessfully&apos; &amp;&amp; status != &apos;cancelled&apos;);
     
     if(status == &apos;finishedSuccessfully&apos; &amp;&amp; callback){
     
         callback(callbackParams)
     }
     
     return status;
     

   };
   
   /**
    * Get a plugin instance running in CUBE from its id
    *
    * @param {number} instId A plugin isntance id
    *
    * @return {Promise&lt;PluginInstance&gt;} A JS Promise, resolves to a PluginInstance object
    */
   async getPluginInstance(instId){
     const pluginInst = await this.chrisClient.getPluginInstance(instId);
     return pluginInst;
   };
}
</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(1.1.0)</span><img src="./image/esdoc-logo-mini-black.png"></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
